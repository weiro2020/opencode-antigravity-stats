# OpenCode Antigravity Stats Plugin (v2)

**Credits**: Developed by **DevCatanzaro**.

This plugin provides real-time visibility into quota usage for Antigravity (Google Cloud) accounts used within OpenCode. It tracks tokens, requests, and rate limits to help you manage your AI model consumption efficiently.

## üöÄ Features

- **Multi-Group Tracking**: Separate quota tracking for **Claude** and **Gemini** models (usage of one doesn't affect the other).
- **Real-time Stats**: Shows Requests Per Minute (RPM), remaining quota %, and reset timers directly in the session title.
- **Smart Calibration**: Estimates your total quota limit based on usage history.
- **Multi-Account Support**: Works seamlessly with **1, 2, or 3+ accounts**.
- **Persistence**: Preserves stats between restarts.

## üìã Prerequisites

1.  **OpenCode Editor**: You need the OpenCode environment.
2.  **Antigravity Plugin**: This plugin relies on the `antigravity-accounts.json` file generated by the main Antigravity Auth plugin. 
    > **Note**: This is handled by [opencode-google-antigravity-auth](https://github.com/shekohex/opencode-google-antigravity-auth) (or a compatible fork) which manages Google Cloud authentication tokens.

## ‚öôÔ∏è How it Works

The plugin intercepts completed assistant messages and:
1.  Identifies the model provider (Google/Antigravity).
2.  Categorizes the model into a group (`claude`, `gemini`, or `other`).
3.  Updates the usage window (5-hour sliding window, enforced by Google).
4.  Updates the session title with a summary.

### Session Title Format

```
[C] US:4/20,92%,4h20,1.8M | US2:0/0,100%,5h0,0
```

- **[C]**: Active Model Group (C=Claude, G=Gemini).
- **US**: Account prefix (first 2 letters of email, uppercased).
- **4/20**: 4 RPM (current) / 20 requests total in window.
- **92%**: Estimated remaining quota.
- **4h20**: Time remaining until the 5-hour window resets.
- **1.8M**: Total tokens used in this window.

## üì¶ Installation

1.  Clone this repository into your OpenCode plugins directory:
    ```bash
    git clone https://github.com/your-repo/opencode-antigravity-stats.git ~/.config/opencode/plugin/opencode-antigravity-stats
    ```

2.  Install dependencies and build:
    ```bash
    cd ~/.config/opencode/plugin/opencode-antigravity-stats
    bun install
    bun run build
    ```

3.  Restart OpenCode.

## üîß Configuration

The plugin automatically creates `~/.config/opencode/antigravity-stats.json` on the first run.

### Using with 1 Account
If you only have one account configured in Antigravity, the plugin will simply show stats for that single account. No extra configuration needed.

### Using with Multiple Accounts
The plugin automatically detects all accounts listed in `antigravity-accounts.json`. It will display a summary section for each account in the title bar (separated by `|`).

### Manual Calibration (Optional)
By default, the plugin assumes a safe limit of **600 requests per 5 hours**. If your account has a higher limit, you can edit `~/.config/opencode/antigravity-stats.json` manually (the plugin preserves your changes):

```json
"calibrations": {
  "claude": {
    "estimatedRequestLimit": 1000  // Increase this if you have more quota
  }
}
```

## üõ† Troubleshooting

**"No quota tracking" in title:**
You are likely using a model that isn't part of the tracked groups (e.g., local models, GitHub Copilot, or non-Google providers).

**Stats not updating:**
Ensure the Antigravity plugin is active and you are using a model provided by it (e.g., `claude-sonnet-4-5-thinking`).

---

*Made with ‚ù§Ô∏è by DevCatanzaro*

---

## ‚öñÔ∏è Disclaimer

**EDUCATIONAL USE ONLY**

This software is a research project intended strictly for **educational and monitoring purposes**. It is designed to help users visualize and understand their own usage patterns of AI services.

1.  **No Affiliation**: This project is **not** affiliated with, endorsed by, or connected to Google, Anthropic, OpenCode, or any other service provider mentioned.
2.  **No Warranty**: The software is provided "as is", without warranty of any kind. The developers are not responsible for any account suspensions, bans, or data loss resulting from the use of this tool.
3.  **Terms of Service**: Users are solely responsible for ensuring that their use of this software complies with the Terms of Service (ToS) of Google Cloud, Antigravity, and any other third-party APIs involved.
4.  **Use at Your Own Risk**: By using this software, you acknowledge that you are doing so voluntarily and assume all risks associated with its use.
